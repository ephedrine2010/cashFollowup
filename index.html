<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cash Daily Followup</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="dialoges/start-cash-count/start-cash-count.css">
    <link rel="stylesheet" href="dialoges/export-data/export-data.css">
</head>
<body>
    <div class="container">
        <!-- Login Screen -->
        <div id="login-screen" class="login-screen">
            <div class="login-card">
                <h1 class="login-title">Cash Daily Followup</h1>
                <div id="login-form" class="auth-form">
                    <input type="text" id="store-id" placeholder="Store ID" />
                    <input type="text" id="emp-id" placeholder="Emp ID" />
                    <button id="login-btn">Login</button>
                    <button id="signup-btn">Sign Up</button>
                    <button id="test-connection-btn" class="test-btn hidden">Test Connection</button>
                </div>
            </div>
            <div class="login-footer">
                <p>By <a href="https://www.linkedin.com/in/mohamed-shanab-154370132/" target="_blank" rel="noopener noreferrer">M. Shanab</a></p>
            </div>
        </div>

        <!-- Header -->
        <header class="hidden">
            <h1>Cash Daily Followup</h1>
            <div id="auth-section">
                <div id="user-info" class="hidden">
                    <span id="user-email"></span>
                    <button id="logout-btn">Logout</button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main id="main-content" class="hidden">
            <!-- Daily Sales Tracking Section -->
            <section class="card sales-section">
                <!-- Sales Entry Form -->
                <div class="sales-form-container">
                    <div class="title-with-actions">
                        <h2>Add Daily Sales Record</h2>
                        <button type="button" id="start-cash-count-btn" class="btn-action">Start Cash Count</button>
                    </div>
                    <form id="sales-form">
                        <div class="form-row">
                            <div class="form-group form-group-sm">
                                <label for="sales-day-no">Day No.:</label>
                                <input type="number" id="sales-day-no" min="1" required />
                            </div>
                        </div>
                        
                        <div class="form-row form-row-tight">
                            <div class="form-group">
                                <label for="sales-total">Total Sales:</label>
                                <input type="number" id="sales-total" step="0.01" min="0" required />
                            </div>
                            <div class="form-group">
                                <label for="sales-on-account">On Account:</label>
                                <input type="number" id="sales-on-account" step="0.01" min="0" value="0" />
                            </div>
                            <div class="form-group">
                                <label for="sales-online">Online:</label>
                                <input type="number" id="sales-online" step="0.01" min="0" value="0" />
                            </div>
                            <div class="form-group">
                                <label for="sales-stc">STC:</label>
                                <input type="number" id="sales-stc" step="0.01" min="0" value="0" />
                            </div>
                            <div class="form-group">
                                <label for="sales-rajhi">Rajhi:</label>
                                <input type="number" id="sales-rajhi" step="0.01" min="0" value="0" />
                            </div>
                            <div class="form-group">
                                <label for="sales-gift">Gift:</label>
                                <input type="number" id="sales-gift" step="0.01" min="0" value="0" />
                            </div>
                            <div class="form-group">
                                <label for="sales-tamra">Tamra:</label>
                                <input type="number" id="sales-tamra" step="0.01" min="0" value="0" />
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="sales-mada">Mada:</label>
                                <div class="input-with-btn">
                                    <input type="number" id="sales-mada" step="0.01" min="0" value="0" readonly />
                                    <button type="button" class="add-values-btn" data-field="mada">+</button>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="sales-visa">Visa:</label>
                                <div class="input-with-btn">
                                    <input type="number" id="sales-visa" step="0.01" min="0" value="0" readonly />
                                    <button type="button" class="add-values-btn" data-field="visa">+</button>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="sales-master">Master:</label>
                                <div class="input-with-btn">
                                    <input type="number" id="sales-master" step="0.01" min="0" value="0" readonly />
                                    <button type="button" class="add-values-btn" data-field="master">+</button>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="sales-other">Other:</label>
                                <input type="number" id="sales-other" step="0.01" min="0" value="0" />
                            </div>
                            <div class="form-group">
                                <label for="sales-total-plastic">Total Plastic:</label>
                                <input type="number" id="sales-total-plastic" step="0.01" readonly value="0" />
                            </div>
                        </div>
                        
                        <div class="form-row-mixed">
                            <div class="form-group form-group-sm">
                                <label for="sales-variance">Variance:</label>
                                <input type="number" id="sales-variance" step="0.01" value="0" />
                            </div>
                            <div class="form-group form-group-sm">
                                <label for="sales-total-cash">Total Cash:</label>
                                <input type="number" id="sales-total-cash" step="0.01" readonly value="0" />
                            </div>
                            <div class="form-group form-group-flex">
                                <label for="sales-note">Note:</label>
                                <input type="text" id="sales-note" placeholder="Enter any notes..." />
                            </div>
                            <div class="form-group">
                                <button type="submit" class="btn-primary" style="margin-bottom: 0;">Add Sales Record</button>
                            </div>
                        </div>
                    </form>
                </div>

                <!-- Sales Table -->
                <div class="sales-table-container">
                    <div class="sales-header">
                        <div class="title-with-btn">
                            <h2>Sales Records</h2>
                            <button type="button" id="export-excel-btn" class="btn-action">Export Excel</button>
                        </div>
                        <div class="year-navigation">
                            <button class="year-nav-btn" id="prev-year-btn" onclick="changeYear(-1)" title="Previous Year">&lt;</button>
                            <div class="year-display" id="year-display">
                                <span class="year-label">Year:</span>
                                <span class="year-value" id="current-year">2026</span>
                            </div>
                            <button class="year-nav-btn" id="next-year-btn" onclick="changeYear(1)" title="Next Year">&gt;</button>
                        </div>
                    </div>
                    
                    <!-- Months Tab -->
                    <div class="months-tab" id="months-tab">
                        <!-- Month buttons will be generated dynamically -->
                    </div>
                    <div class="table-wrapper">
                        <table id="sales-table" class="sales-table">
                            <thead>
                                <tr>
                                    <th class="day-no-column">Day No.</th>
                                    <th>Total Sales</th>
                                    <th>On Account</th>
                                    <th>Online</th>
                                    <th>STC</th>
                                    <th>Rajhi</th>
                                    <th>Gift</th>
                                    <th>Tamra</th>
                                    <th class="plastic-column">Mada</th>
                                    <th class="plastic-column">Visa</th>
                                    <th class="plastic-column">Master</th>
                                    <th class="plastic-column">Other</th>
                                    <th class="total-plastic-column">Total Plastic</th>
                                    <th>Variance</th>
                                    <th class="total-cash-column">Total Cash</th>
                                    <th>Amanco</th>
                                    <th>Actions</th>
                                    <th>Note</th>
                                </tr>
                            </thead>
                            <tbody id="sales-table-body">
                                <tr class="empty-row">
                                    <td colspan="18" class="empty-state">No sales records yet. Add your first record above!</td>
                                </tr>
                            </tbody>
                            <tfoot>
                                <tr class="summary-row">
                                    <td colspan="14" class="summary-label">Total Cash (Unchecked Amanco):</td>
                                    <td id="total-cash-summary" class="summary-value total-cash-column">0.00</td>
                                    <td colspan="3"></td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Loading Spinner -->
    <div id="loading" class="loading hidden">
        <div class="spinner"></div>
    </div>

    <!-- Multiple Values Dialog -->
    <div id="values-dialog" class="dialog-overlay hidden">
        <div class="dialog-content">
            <div class="dialog-header">
                <h3 id="dialog-title">Enter Multiple Values</h3>
                <button class="dialog-close" onclick="closeValuesDialog()">&times;</button>
            </div>
            <div class="dialog-body">
                <div id="values-container" class="values-container">
                    <!-- Value inputs will be generated dynamically -->
                </div>
                <button type="button" class="btn-add-more" onclick="addMoreValueInput()">+ Add More</button>
            </div>
            <div class="dialog-footer">
                <div class="dialog-summary">
                    <strong>Total:</strong> <span id="dialog-total">0.00</span>
                </div>
                <button type="button" class="btn-secondary" onclick="closeValuesDialog()">Cancel</button>
                <button type="button" class="btn-primary" onclick="saveMultipleValues()">Save</button>
            </div>
        </div>
    </div>

    <!-- Export Data Dialog Container -->
    <div id="export-data-container"></div>

    <!-- Start Cash Count Dialog Container -->
    <div id="start-cash-count-container">
        <div id="start-cash-count-dialog" class="dialog-overlay hidden">
            <div class="dialog-content start-cash-count-content">
                <div class="dialog-header">
                    <h3>Start Cash Count</h3>
                    <button class="dialog-close" id="close-start-cash-btn">&times;</button>
                </div>
                <div class="dialog-body">
                    <div class="start-cash-grid">
                        <!-- Left Side: Basic Counts -->
                        <div class="count-main-section">
                            <div class="form-group">
                                <label for="scc-total-cash">Total Cash (from sales):</label>
                                <input type="number" id="scc-total-cash" step="0.01" readonly />
                            </div>
                            <div class="form-group">
                                <label for="scc-start-cash">Start Cash:</label>
                                <input type="number" id="scc-start-cash" step="0.01" min="0" value="0" />
                            </div>
                            <div class="form-group">
                                <label for="scc-total-expected">Total Cash + Start Cash:</label>
                                <input type="number" id="scc-total-expected" step="0.01" readonly />
                            </div>
                            <div class="form-group">
                                <label for="scc-cashier-count">Cashier Count:</label>
                                <input type="number" id="scc-cashier-count" step="0.01" min="0" value="0" />
                            </div>
                            <div class="form-group">
                                <label for="scc-safe-count">Safe Count:</label>
                                <input type="number" id="scc-safe-count" step="0.01" min="0" value="0" />
                            </div>
                            <div class="form-group deficit-group">
                                <label for="scc-deficit">Deficit:</label>
                                <input type="number" id="scc-deficit" step="0.01" readonly />
                            </div>
                        </div>

                        <!-- Right Side: Delivery Orders -->
                        <div class="count-delivery-section">
                            <h4>Delivery Orders</h4>
                            <div id="scc-delivery-container" class="delivery-container">
                                <!-- Dynamic delivery order inputs -->
                            </div>
                            <button type="button" class="btn-add-more" id="scc-add-delivery-btn">+ Add More</button>
                            <div class="form-group group-summary-group">
                                <label for="scc-group-summary">Group Summary:</label>
                                <input type="number" id="scc-group-summary" step="0.01" readonly value="0.00" />
                            </div>
                        </div>
                    </div>
                </div>
                <div class="dialog-footer">
                    <button type="button" class="btn-secondary" id="cancel-start-cash-btn">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- App Scripts (using ES6 modules) -->
    <script type="module" src="js/firebase-config.js"></script>
    <script type="module" src="js/utils.js"></script>
    <script type="module" src="js/auth.js"></script>
    <script type="module" src="js/sales.js"></script>
    <script type="module" src="dialoges/export-data/export-data.js"></script>
    <script type="module" src="js/app.js"></script>
</body>
</html>
